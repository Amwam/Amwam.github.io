<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="https://fonts.xz.style/serve/inter.css"/><link href="https://cdn.jsdelivr.net/npm/prismjs@1.20.0/themes/prism.css" rel="stylesheet"/><title>Using React with Web Components | AMWAM - Amit Shah</title><meta name="next-head-count" content="5"/><link rel="preload" href="/_next/static/css/a60b5345ba614badf12b.css" as="style"/><link rel="stylesheet" href="/_next/static/css/a60b5345ba614badf12b.css"/><link rel="preload" href="/_next/static/css/4609f3bbaca7d45237f4.css" as="style"/><link rel="stylesheet" href="/_next/static/css/4609f3bbaca7d45237f4.css"/><link rel="preload" href="/_next/static/XKs_910cSPV7uibIY_vVk/pages/_app.js" as="script"/><link rel="preload" href="/_next/static/XKs_910cSPV7uibIY_vVk/pages/blog/%5Bslug%5D.js" as="script"/><link rel="preload" href="/_next/static/runtime/webpack-c212667a5f965e81e004.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.4dd1003cc9c949c7fcd3.js" as="script"/><link rel="preload" href="/_next/static/chunks/39b5150de888aa7f4406e457b40b9418a98ddf3d.638a41a739461475fef6.js" as="script"/><link rel="preload" href="/_next/static/chunks/610a647bd496f12181390eeffdbe8b17d963b84e.d7a7f7949af587bbd8a1.js" as="script"/><link rel="preload" href="/_next/static/runtime/main-5655d340547bb835631a.js" as="script"/></head><body><div id="__next"><div class="_app_container__Bd60j"><div id="Navigation_nav-bar__3bKV6" role="navigation"><img id="Navigation_nav-display-picture__10cr9" src="/images/me.jpg" alt="Me (Amit)" loading="lazy"/><div id="Navigation_name__3hC26">Amit Shah</div><div id="Navigation_nav-links__1I62P"><div class="Navigation_nav-link__-yzJz"><a href="/">Home</a></div><div class="Navigation_nav-link__-yzJz"><a href="/about">About</a></div><div class="Navigation_nav-link__-yzJz"><a href="/blog">Blog</a></div><div class="Navigation_nav-link__-yzJz"><a href="/contact">Contact</a></div></div></div><div id="_app_content-wrapper__23yBS"><main id="_app_content__3Z-Um"><div><h1>Using React with Web Components</h1><h4>7/2/2017</h4><div class="style_tags__2EmJP"><span><a href="/blog?tag=javascript">javascript</a> </span><span><a href="/blog?tag=react">react</a> </span></div><p>Dealing with legacy code can be tough, even more so if you want to slowly migrate your front end to React.</p><p>Recently I found myself in a situation where some HTML was rendered server side, and inserted into the browser on request. I wanted to use a shiny new React component, instead of falling back to the legacy jQuery code.</p><p>In comes <a href="https://www.webcomponents.org">Web Components</a>!</p><p>Web Components allow you to write your own HTML tags, and use them through out your application. This solves my problem, by having the server render the new HTML tag, and the front end automatically load the required JavaScript to render/control it. When rendering the Web Component we can delegate the actual rendering to React.</p><p>Lets start with a simple React component:</p><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">MyComponent</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">></span>Hello world<span class="token operator">!</span> This was rendered using React<span class="token operator">!</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>In order to render the component, we have to create a new HTMLElement as so:</p><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">CustomHTMLElement</span> <span class="token keyword">extends</span> <span class="token class-name">HTMLElement</span> <span class="token punctuation">{</span>
  <span class="token function">connectedCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>MyComponent <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>In this, when the component is loaded by the browser, the <code>connectedCallback</code> will be called, allowing us to render the new component, at <code>this</code> (the location of the element in the DOM).</p><p>To finish, we just have to register the element with the customElements API:</p><pre class="language-javascript"><code class="language-javascript">customElements<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">"x-test"</span><span class="token punctuation">,</span> CustomHTMLElement<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Now we can just use the tag <code>&lt;x-test/&gt;</code> in our HTML, to render the React component!</p><p>One problem with this setup can be <a href="https://babeljs.io">Babel</a>, as it doesn&#x27;t play nice with transforming classes and extending <code>HTMLElement</code>.
We can work around this using a custom class, and extending the prototype of HTMLElement:</p><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">BabelHTMLElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> newTarget <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">getPrototypeOf</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span>constructor<span class="token punctuation">;</span>
  <span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">construct</span><span class="token punctuation">(</span>HTMLElement<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> newTarget<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

Object<span class="token punctuation">.</span><span class="token function">setPrototypeOf</span><span class="token punctuation">(</span><span class="token class-name">BabelHTMLElement</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> <span class="token class-name">HTMLElement</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">CustomHTMLElement</span> <span class="token keyword">extends</span> <span class="token class-name">BabelHTMLElement</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span></code></pre><p>Now our <code>CustomHTMLElement</code> extends the <code>BabelHTMLElement</code> rather the <code>HTMLElement</code> directly.</p><p>To view an example project with this in use, you can checkout the repo here: <a href="https://github.com/Amwam/react-webcomponents">https://github.com/Amwam/react-webcomponents</a></p></div></main></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"POST":"Dealing with legacy code can be tough, even more so if you want to slowly migrate your front end to React.\n\nRecently I found myself in a situation where some HTML was rendered server side, and inserted into the browser on request. I wanted to use a shiny new React component, instead of falling back to the legacy jQuery code.\n\nIn comes [Web Components](https://www.webcomponents.org)!\n\nWeb Components allow you to write your own HTML tags, and use them through out your application. This solves my problem, by having the server render the new HTML tag, and the front end automatically load the required JavaScript to render/control it. When rendering the Web Component we can delegate the actual rendering to React.\n\nLets start with a simple React component:\n\n```JavaScript\nimport React from \"react\";\n\nclass MyComponent extends React.Component {\n  render() {\n    return \u003cdiv\u003eHello world! This was rendered using React!\u003c/div\u003e;\n  }\n}\n```\n\nIn order to render the component, we have to create a new HTMLElement as so:\n\n```JavaScript\nclass CustomHTMLElement extends HTMLElement {\n  connectedCallback() {\n    ReactDOM.render(\u003cMyComponent /\u003e, this);\n  }\n}\n```\n\nIn this, when the component is loaded by the browser, the `connectedCallback` will be called, allowing us to render the new component, at `this` (the location of the element in the DOM).\n\nTo finish, we just have to register the element with the customElements API:\n\n```JavaScript\ncustomElements.define(\"x-test\", CustomHTMLElement);\n```\n\nNow we can just use the tag `\u003cx-test/\u003e` in our HTML, to render the React component!\n\nOne problem with this setup can be [Babel](https://babeljs.io), as it doesn't play nice with transforming classes and extending `HTMLElement`.\nWe can work around this using a custom class, and extending the prototype of HTMLElement:\n\n```JavaScript\nfunction BabelHTMLElement() {\n  const newTarget = Object.getPrototypeOf(this).constructor;\n  return Reflect.construct(HTMLElement, [], newTarget);\n}\n\nObject.setPrototypeOf(BabelHTMLElement.prototype, HTMLElement.prototype);\n\nclass CustomHTMLElement extends BabelHTMLElement {\n    ...\n```\n\nNow our `CustomHTMLElement` extends the `BabelHTMLElement` rather the `HTMLElement` directly.\n\nTo view an example project with this in use, you can checkout the repo here: [https://github.com/Amwam/react-webcomponents](https://github.com/Amwam/react-webcomponents)\n"},"__N_SSG":true},"page":"/blog/[slug]","query":{"slug":"react-web-components"},"buildId":"XKs_910cSPV7uibIY_vVk","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/runtime/polyfills-f1eec38e83a82f41790c.js"></script><script async="" data-next-page="/_app" src="/_next/static/XKs_910cSPV7uibIY_vVk/pages/_app.js"></script><script async="" data-next-page="/blog/[slug]" src="/_next/static/XKs_910cSPV7uibIY_vVk/pages/blog/%5Bslug%5D.js"></script><script src="/_next/static/runtime/webpack-c212667a5f965e81e004.js" async=""></script><script src="/_next/static/chunks/framework.4dd1003cc9c949c7fcd3.js" async=""></script><script src="/_next/static/chunks/39b5150de888aa7f4406e457b40b9418a98ddf3d.638a41a739461475fef6.js" async=""></script><script src="/_next/static/chunks/610a647bd496f12181390eeffdbe8b17d963b84e.d7a7f7949af587bbd8a1.js" async=""></script><script src="/_next/static/runtime/main-5655d340547bb835631a.js" async=""></script><script src="/_next/static/XKs_910cSPV7uibIY_vVk/_buildManifest.js" async=""></script><script src="/_next/static/XKs_910cSPV7uibIY_vVk/_ssgManifest.js" async=""></script></body></html>